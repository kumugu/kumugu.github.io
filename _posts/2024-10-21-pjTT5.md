---
layout: single
title: "테트리스 게임 만들기 3"
categories: GAME
tag: [TETRIS]
author_profile: false
sidebar:
    nav: "docs"
toc: true
toc_sticky: true
---

```
테트로미노를 아래로 떨어뜨리는 동작과 게임 보드에 테트로미노가 충돌할 때 멈추는 기능을 구현. 
테트로미노가 일정한 간격으로 아래로 이동하고, 보드의 경계에 도달하면 멈추는 기본 동작을 구현. 
```
## 단계별 구현 방법

```
1. 게임 루프 설정
테트리스를 구현하려면 일정한 주기로 화면을 업데이트하는 게임 루프가 필요.
setInterval()을 사용하여 특정 시간 간격마다 게임 상태를 업데이트할 수 있도록 함.

2. 테트로미노의 위치 업데이트
테트로미노가 아래로 떨어지도록 하기 위해, 테트로미노의 y 좌표를 매번 업데이트. 
이 값은 테트로미노의 시작 위치(y = 0)에서 시작하여 게임 루프가 반복될 때마다 증가하게 됨.

3. 경계 체크
테트로미노가 보드의 바닥에 도달하면 멈추도록 경계 체크. 
이를 통해 테트로미노가 보드 아래로 넘어가는 것을 방지할 수 있음.
```


## 1. 게임 루프 설정
setInterval()을 사용하여 매 500밀리초(0.5초)마다 테트로미노의 위치를 업데이트하고 화면을 다시 그림. <br/>

```javascript
let tetrominoY = 0; // 테트로미노의 Y 위치 초기화
const dropInterval = 500; // 테트로미노가 이동하는 시간 간격 (500ms)

// 게임 루프 설정
setInterval(() => {
    updateGame();
}, dropInterval);
```
tetrominoY는 테트로미노의 현재 Y 위치를 나타내며, 초기값은 0.<br/>
dropInterval은 테트로미노가 일정 시간마다 한 칸씩 아래로 이동하는 시간을 설정.<br/>

## 2. updateGame 함수 작성
updateGame 함수는 게임 루프에서 매번 호출되며, 테트로미노의 위치를 업데이트하고 다시 화면에 그림.<br/>

```javascript
function updateGame() {
    // 테트로미노의 Y 위치를 한 칸 아래로 이동
    tetrominoY++;

    // 테트로미노가 바닥에 도달했는지 확인
    if (tetrominoY >= rows) {
        tetrominoY = rows - 1; // 더 이상 이동하지 않도록 Y 위치 고정
        // 나중에 테트로미노 고정 및 새로운 테트로미노 생성 로직 추가 예정
    }

    // 기존 화면을 지우고 새로 그리기
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawGrid(); // 그리드 다시 그리기
    drawTetromino(); // 테트로미노 다시 그리기
}
```

테트로미노의 Y 위치 증가: tetrominoY++로 한 번 호출될 때마다 한 칸씩 아래로 이동.<br/>
경계 체크: if (tetrominoY >= rows)로 테트로미노가 보드의 바닥에 도달했는지 확인하고,<br/> 
도달한 경우 더 이상 이동하지 않도록함.<br/>
화면 업데이트: clearRect()를 사용하여 캔버스를 지우고, <br/>
drawGrid()와 drawTetromino()를 다시 호출하여 새롭게 상태를 반영한 화면을 그림.<br/>

## 3. drawTetromino 함수 수정
이제 테트로미노가 tetrominoY 값을 기준으로 아래로 이동하도록 drawTetromino 함수를 수정.<br/>

```javascript
function drawTetromino() {
    if (!ctx) return;

    const x = 3; // 열 위치를 3으로 설정 (고정)
    const y = tetrominoY; // 행 위치를 tetrominoY로 설정하여 아래로 이동

    for (let row = 0; row < tetromino.length; row++) {
        for (let col = 0; col < tetromino[row].length; col++) {
            if (tetromino[row][col] === 1) {
                ctx.fillStyle = "cyan";
                ctx.fillRect((x + col) * blockSize, (y + row) * blockSize, blockSize, blockSize);
            }
        }
    }
}
```
drawTetromino 함수는 tetrominoY 값을 사용하여 테트로미노의 행 위치를 조정. <br/>
이렇게 하면 게임 루프가 실행될 때마다 테트로미노가 한 칸씩 아래로 이동하게 됨. <br/>

## 4. 최종 코드 확인
모든 부분을 종합하여 작성된 코드는 다음과 같다: <br/>

```javascript
document.addEventListener("DOMContentLoaded", () => {
    const canvas = document.getElementById("gameCanvas");
    ctx = canvas ? canvas.getContext("2d") : null;

    const rows = 20; 
    const cols = 10; 
    drawGrid(); 

    // 게임 루프 설정
    setInterval(() => {
        updateGame();
    }, dropInterval);
});

let ctx;
const blockSize = 30; 
let tetrominoY = 0;
const dropInterval = 500;

const tetromino = [
    [1, 1, 1, 1]
];

function drawGrid() {
    if (!ctx) return;

    ctx.strokeStyle = "gray";
    for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
            ctx.strokeRect(col * blockSize, row * blockSize, blockSize, blockSize); 
        }
    }
}

function drawTetromino() {
    if (!ctx) return;

    const x = 3; 
    const y = tetrominoY;

    for (let row = 0; row < tetromino.length; row++) {
        for (let col = 0; col < tetromino[row].length; col++) {
            if (tetromino[row][col] === 1) {
                ctx.fillStyle = "cyan";
                ctx.fillRect((x + col) * blockSize, (y + row) * blockSize, blockSize, blockSize);
            }
        }
    }
}

function updateGame() {
    tetrominoY++;

    if (tetrominoY >= rows) {
        tetrominoY = rows - 1; 
    }

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawGrid(); 
    drawTetromino(); 
}
```
이제 이 코드를 실행하면, 테트로미노가 일정 간격으로 아래로 떨어지는 것을 확인할 수 있음. <br/>
다음 단계에서는 테트로미노가 바닥에 닿을 때 새로운 테트로미노를 생성하거나, 회전 및 이동을 추가할 예정